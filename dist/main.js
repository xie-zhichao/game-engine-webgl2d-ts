!function(e){var t={};function i(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(s,r,function(t){return e[t]}.bind(null,r));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=25)}([function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(9);var r;!function(e){e[e.NORMAL=0]="NORMAL",e[e.HIGH=1]="HIGH"}(r=t.MessagePriority||(t.MessagePriority={}));class o{constructor(e,t,i,s=r.NORMAL){this.code=e,this.sender=t,this.context=i,this.priority=s}static send(e,t,i){s.MessageBus.post(new o(e,t,i))}sendPriority(e,t,i){s.MessageBus.post(new o(e,t,i,r.HIGH))}static subscribe(e,t){s.MessageBus.addSubscription(e,t)}static unsubscribe(e,t){s.MessageBus.removeSubscription(e,t)}}t.Message=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(2);class r{constructor(e=0,t=0){this._x=e,this._y=t}get x(){return this._x}set x(e){this._x=e}get y(){return this._y}set y(e){this._y=e}static get zero(){return new r}static get one(){return new r(1,1)}static distance(e,t){let i=e.clone().subtract(t);return Math.sqrt(i.x*i.x+i.y*i.y)}copyFrom(e){this._x=e._x,this._y=e._y}toArray(){return[this._x,this._y]}toFloat32Array(){return new Float32Array(this.toArray())}toVector3(){return new s.Vector3(this._x,this._y,0)}set(e,t){void 0!==e&&(this._x=e),void 0!==t&&(this._y=t)}setFromJson(e){void 0!==e.x&&(this._x=Number(e.x)),void 0!==e.y&&(this._y=Number(e.y))}add(e){return this._x+=e._x,this._y+=e._y,this}subtract(e){return this._x-=e._x,this._y-=e._y,this}multiply(e){return this._x*=e._x,this._y*=e._y,this}divide(e){return this._x/=e._x,this._y/=e._y,this}scale(e){return this._x*=e,this._y*=e,this}clone(){return new r(this._x,this._y)}}t.Vector2=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(1);class r{constructor(e=0,t=0,i=0){this._x=e,this._y=t,this._z=i}get x(){return this._x}set x(e){this._x=e}get y(){return this._y}set y(e){this._y=e}get z(){return this._z}set z(e){this._z=e}static get zero(){return new r}static get one(){return new r(1,1,1)}static distance(e,t){let i=e.subtract(t);return Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z)}set(e,t,i){void 0!==e&&(this._x=e),void 0!==t&&(this._y=t),void 0!==i&&(this._z=i)}equals(e){return this.x===e.x&&this.y===e.y&&this.z===e.z}toArray(){return[this._x,this._y,this._z]}toFloat32Array(){return new Float32Array(this.toArray())}copyFrom(e){this._x=e._x,this._y=e._y,this._z=e._z}setFromJson(e){void 0!==e.x&&(this._x=Number(e.x)),void 0!==e.y&&(this._y=Number(e.y)),void 0!==e.z&&(this._z=Number(e.z))}add(e){return this._x+=e._x,this._y+=e._y,this._z+=e._z,this}subtract(e){return this._x-=e._x,this._y-=e._y,this._z-=e._z,this}multiply(e){return this._x*=e._x,this._y*=e._y,this._z*=e._z,this}divide(e){return this._x/=e._x,this._y/=e._y,this._z/=e._z,this}clone(){return new r(this._x,this._y,this._z)}toVector2(){return new s.Vector2(this._x,this._y)}}t.Vector3=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0),r=i(29),o=i(30),n=i(31);t.MESSAGE_ASSET_LOADER_ASSET_LOADED="MESSAGE_ASSET_LOADER_ASSET_LOADED::";class a{constructor(){}static initialize(){a.loaders.push(new r.ImageAssetLoader),a.loaders.push(new o.JsonAssetLoader),a.loaders.push(new n.TextAssetLoader)}static registerLoader(e){a.loaders.push(e)}static onAssetLoaded(e){a.loadedAssets[e.name]=e,s.Message.send(t.MESSAGE_ASSET_LOADER_ASSET_LOADED+e.name,this,e)}static loadAsset(e){const t=(e.split(".").pop()||"").toLowerCase();for(const i of a.loaders)if(-1!==i.supportedExtensions.indexOf(t))return void i.loadAsset(e);console.warn(`there is no loader to load asset with extension: ${t}`)}static isAssetLoaded(e){return void 0!==a.loadedAssets[e]}static getAsset(e){if(void 0!==a.loadedAssets[e])return a.loadedAssets[e];a.loadAsset(e)}}t.AssetManager=a,a.loaders=[],a.loadedAssets={}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BaseBehavior=class{constructor(e){this._data=e,this.name=this._data.name}setOwner(e){this._owner=e}getOwner(){return this._owner}updateReady(){}update(e){}apply(e){}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BaseComponent=class{constructor(e){this._data=e,this.name=e.name}getOwner(){return this.owner}setOwner(e){this.owner=e}load(){}updateReady(){}update(e){}render(e){}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(){this._data=[],this._data=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}get data(){return this._data}static identity(){return new s}static orthographic(e,t,i,r,o,n){let a=new s,h=1/(e-t),d=1/(i-r),c=1/(o-n);return a._data[0]=-2*h,a._data[5]=-2*d,a._data[10]=2*c,a._data[12]=(e+t)*h,a._data[13]=(r+i)*d,a._data[14]=(n+o)*c,a}static translation(e){let t=new s;return t._data[12]=e.x,t._data[13]=e.y,t._data[14]=e.z,t}static rotationX(e){let t=new s,i=Math.cos(e),r=Math.sin(e);return t._data[5]=i,t._data[6]=r,t._data[9]=-r,t._data[10]=i,t}static rotationY(e){let t=new s,i=Math.cos(e),r=Math.sin(e);return t._data[0]=i,t._data[2]=-r,t._data[8]=r,t._data[10]=i,t}static rotationZ(e){let t=new s,i=Math.cos(e),r=Math.sin(e);return t._data[0]=i,t._data[1]=r,t._data[4]=-r,t._data[5]=i,t}static rotationXYZ(e,t,i){let r=s.rotationX(e),o=s.rotationY(t),n=s.rotationZ(i);return s.multiply(s.multiply(n,o),r)}static scale(e){let t=new s;return t._data[0]=e.x,t._data[5]=e.y,t._data[10]=e.z,t}static multiply(e,t){let i=new s,r=t._data[0],o=t._data[1],n=t._data[2],a=t._data[3],h=t._data[4],d=t._data[5],c=t._data[6],l=t._data[7],u=t._data[8],_=t._data[9],m=t._data[10],p=t._data[11],f=t._data[12],g=t._data[13],w=t._data[14],y=t._data[15],v=e._data[0],b=e._data[1],x=e._data[2],M=e._data[3],E=e._data[4],A=e._data[5],S=e._data[6],C=e._data[7],T=e._data[8],F=e._data[9],P=e._data[10],O=e._data[11],B=e._data[12],D=e._data[13],N=e._data[14],L=e._data[15];return i._data[0]=r*v+o*E+n*T+a*B,i._data[1]=r*b+o*A+n*F+a*D,i._data[2]=r*x+o*S+n*P+a*N,i._data[3]=r*M+o*C+n*O+a*L,i._data[4]=h*v+d*E+c*T+l*B,i._data[5]=h*b+d*A+c*F+l*D,i._data[6]=h*x+d*S+c*P+l*N,i._data[7]=h*M+d*C+c*O+l*L,i._data[8]=u*v+_*E+m*T+p*B,i._data[9]=u*b+_*A+m*F+p*D,i._data[10]=u*x+_*S+m*P+p*N,i._data[11]=u*M+_*C+m*O+p*L,i._data[12]=f*v+g*E+w*T+y*B,i._data[13]=f*b+g*A+w*F+y*D,i._data[14]=f*x+g*S+w*P+y*N,i._data[15]=f*M+g*C+w*O+y*L,i}toFloat32Array(){return new Float32Array(this._data)}copyFrom(e){for(let t=0;t<16;++t)this._data[t]=e._data[t]}}t.Matrix4x4=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{static get(e,t){return s.exec(e,"get",null,t)}static post(e,t,i){return s.exec(e,"post",t,i)}static exec(e,t,i,s){return new Promise((function(r,o){const n=new XMLHttpRequest,{timeout:a=3e3,responseType:h="text"}=s||{};n.timeout=a,n.responseType=h,n.open(t,e),n.onload=function(){200===n.status?r({success:!0,status:200,message:"ok",response:n.responseText}):o({success:!1,status:n.status,message:"error",response:n.responseText})},n.onerror=function(){o({success:!1,status:n.status,message:"error"})},n.ontimeout=function(){o({success:!1,status:n.status,message:"timeout"})},n.send(i)}))}}t.HttpClient=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(e){this.referenceCount=1,this.material=e}}class r{constructor(){}static registerMaterial(e){void 0===r._materials[e.name]&&(r._materials[e.name]=new s(e))}static getMaterial(e){return void 0===r._materials[e]?void 0:(r._materials[e].referenceCount++,r._materials[e].material)}static releaseMaterial(e){const t=r._materials[e];void 0===t?console.warn(`Material named ${e} has not been registered.`):(t.referenceCount--,t.referenceCount<1&&(t.material.destroy(),delete r._materials[e]))}}t.MaterialManager=r,r._materials={}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(28),r=i(0);class o{constructor(){}static addSubscription(e,t){void 0===o.subscriptions[e]&&(o.subscriptions[e]=[]),-1!==o.subscriptions[e].indexOf(t)?console.log(`Attempting to add a duplicate handler to code: ${e}, subscription not added.`):o.subscriptions[e].push(t)}static removeSubscription(e,t){if(void 0===o.subscriptions[e])return void console.warn(`Cannot unsubscribe handler from code: ${e}, this code is not subscribed.`);const i=o.subscriptions[e].indexOf(t);-1!==i&&o.subscriptions[e].splice(i,1)}static post(e){console.log("Message posted:",e);const t=o.subscriptions[e.code];if(void 0!==t)for(const i of t)e.priority===r.MessagePriority.HIGH?i.onMessage(e):o.normalMessageQueue.push(new s.MessageSubscriptionNode(e,i))}static update(e){if(0===o.normalMessageQueue.length)return;const t=Math.min(o.normalQueueMessagePerUpdate,o.normalMessageQueue.length);for(let e=0;e<t;e++){const e=o.normalMessageQueue.pop();e&&e.handler.onMessage(e.message)}}}t.MessageBus=o,o.subscriptions={},o.normalQueueMessagePerUpdate=10,o.normalMessageQueue=[]},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(34);t.Material=class{constructor(e,t,i,r){this.gl=e,this._name=t,this._diffuseTextureName=i,this._tint=r,this._diffuseTexture=s.TextureManager.getTexture(e,this._diffuseTextureName)}get name(){return this._name}get diffuseTextureName(){return this._diffuseTextureName}get diffuseTexture(){return this._diffuseTexture}get tint(){return this._tint}set diffuseTextureName(e){s.TextureManager.releaseTexture(this._diffuseTextureName),this._diffuseTextureName=e,this._diffuseTexture=s.TextureManager.getTexture(this.gl,this._diffuseTextureName)}destroy(){s.TextureManager.releaseTexture(this._diffuseTextureName),this._diffuseTexture=void 0}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(e=255,t=255,i=255,s=255){this._r=e,this._g=t,this._b=i,this._a=s}get r(){return this._r}get rFloat(){return this._r/255}set r(e){this._r=e}get g(){return this._g}get gFloat(){return this._g/255}set g(e){this._g=e}get b(){return this._b}get bFloat(){return this._b/255}set b(e){this._b=e}get a(){return this._r}get aFloat(){return this._a/255}set a(e){this._a=e}toArray(){return[this._r,this._g,this._b,this._a]}toFloatArray(){return[this._r/255,this._g/255,this._b/255,this._a/255]}toFloat32Array(){return new Float32Array(this.toFloatArray())}static white(){return new s(255,255,255,255)}static black(){return new s(0,0,0,255)}static red(){return new s(255,0,0,255)}static green(){return new s(0,255,0,255)}static blue(){return new s(0,0,255,255)}}t.Color=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(6),r=i(39),o=i(2);t.SimObject=class{constructor(e,t,i){this._children=[],this._isLoaded=!1,this._components=[],this._behaviors=[],this._isVisible=!0,this._localMatrix=s.Matrix4x4.identity(),this._worldMatrix=s.Matrix4x4.identity(),this.transform=new r.Transform,this._id=e,this.name=t,this._scene=i}get id(){return this._id}get parent(){return this._parent}get worldMatrix(){return this._worldMatrix}get isLoaded(){return this._isLoaded}get isVisible(){return this._isVisible}set isVisible(e){this._isVisible=e}addChild(e){e._parent=this,this._children.push(e),e.onAdded(this._scene)}removeChild(e){const t=this._children.indexOf(e);-1!==t&&(e._parent=void 0,this._children.splice(t,1))}getComponentByName(e){for(const t of this._components)if(t.name===e)return t;for(const t of this._children){const i=t.getComponentByName(e);if(void 0!==i)return i}}getObjectByName(e){if(this.name===e)return this;for(const t of this._children){const i=t.getObjectByName(e);if(void 0!==i)return i}}addComponent(e){this._components.push(e),e.setOwner(this)}addBehavior(e){this._behaviors.push(e),e.setOwner(this)}load(){for(const e of this._components)e.load();for(const e of this._children)e.load();this._isLoaded=!0}updateReady(){for(const e of this._children)e.updateReady();for(const e of this._behaviors)e.updateReady();for(const e of this._children)e.updateReady()}update(e){this._localMatrix=this.transform.getTransformationMatrix(),this.updateWorldMatrix(void 0!==this._parent?this._parent.worldMatrix:void 0);for(const t of this._components)t.update(e);for(const t of this._behaviors)t.update(e);for(const t of this._children)t.update(e)}render(e){if(this._isVisible){for(const t of this._components)t.render(e);for(const t of this._children)t.render(e)}}getWorldPosition(){return new o.Vector3(this._worldMatrix.data[12],this._worldMatrix.data[13],this._worldMatrix.data[14])}onAdded(e){this._scene=e}updateWorldMatrix(e){void 0!==e?this._worldMatrix=s.Matrix4x4.multiply(e,this._localMatrix):this._worldMatrix.copyFrom(this._localMatrix)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(){}static registerBuilder(e){s._registeredBuilders[e.type]=e}static extractComponent(e,t){if(void 0!==t.type){const i=s._registeredBuilders[String(t.type)];if(void 0!==i)return i.buildFromJson(e,t)}throw new Error(`Component manager error - type is missing or builder is not registered for this type: ${t.type}.`)}}t.ComponentManager=s,s._registeredBuilders={}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{static registerBuilder(e){s._registeredBuilders[e.type]=e}static extractBehavior(e){if(void 0!==e.type){const t=s._registeredBuilders[String(e.type)];if(void 0!==t)return t.buildFromJson(e)}throw new Error(`Behavior manager error: type: ${e.type} is missing or builder is not registered.`)}}t.BehaviorManager=s,s._registeredBuilders={}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(5),r=i(16);class o{setFromJson(e){void 0!==e.name&&(this.name=String(e.name)),void 0!==e.materialName&&(this.materialName=String(e.materialName))}}t.SpriteComponentData=o;t.SpriteComponentBuilder=class{get type(){return"sprite"}buildFromJson(e,t){const i=new o;return i.setFromJson(t),new n(e,i)}};class n extends s.BaseComponent{constructor(e,t){if(super(t),void 0===t.materialName)throw new Error("create SpriteComponent error, materialName undefined.");this._sprite=new r.Sprite(e,name,t.materialName)}load(){this._sprite.load()}render(e){if(void 0===this.owner)throw new Error("render SpriteComponent error, owner undefined.");this._sprite.draw(e,this.owner.worldMatrix),super.render(e)}}t.SpriteComponent=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(17),r=i(8),o=i(18),n=i(2);t.Sprite=class{constructor(e,t,i,o=100,a=100){this._origin=n.Vector3.zero,this.vertices=[],this.gl=e,this._name=t,this.materialName=i;const h=r.MaterialManager.getMaterial(i);if(void 0===h)throw new Error(`material: ${i} not found.`);this.material=h,this.buffer=new s.GLBuffer(this.gl),this._width=o,this._height=a}get name(){return this._name}get origin(){return this._origin}get width(){return this._width}get height(){return this._height}set origin(e){this._origin=e,this.recalculateVertices()}destroy(){this.buffer&&this.buffer.destroy(),r.MaterialManager.releaseMaterial(this.materialName),this.material=void 0,this.materialName=""}calculateVertices(){const e=-this._width*this._origin.x,t=this._width*(1-this._origin.x),i=-this._height*this._origin.y,s=this._height*(1-this._origin.y);this.vertices=[new o.Vertex(e,i,0,0,0),new o.Vertex(e,s,0,0,1),new o.Vertex(t,s,0,1,1),new o.Vertex(t,s,0,1,1),new o.Vertex(t,i,0,1,0),new o.Vertex(e,i,0,0,0)];for(const e of this.vertices)this.buffer.pushBackData(e.toArray());this.buffer.upload(),this.buffer.unbind()}recalculateVertices(){const e=-this._width*this._origin.x,t=this._width*(1-this._origin.x),i=-this._height*this._origin.y,s=this._height*(1-this._origin.y);this.vertices[0].position.set(e,i),this.vertices[1].position.set(e,s),this.vertices[2].position.set(t,s),this.vertices[3].position.set(t,s),this.vertices[4].position.set(t,i),this.vertices[5].position.set(e,i);for(const e of this.vertices)this.buffer.pushBackData(e.toArray());this.buffer.upload(),this.buffer.unbind()}load(){const e=new s.AttributeInfo(0,3,0);this.buffer.addAttributeLocation(e);const t=new s.AttributeInfo(1,2,3);this.buffer.addAttributeLocation(t),this.calculateVertices()}update(e){}draw(e,t){if(void 0===this.buffer)throw new Error("buffer is not initialized!");if(void 0===this.material)throw new Error("material is not initialized!");const i=e.getUniformLocation("u_tint");this.gl.uniform4fv(i,this.material.tint.toFloat32Array());const s=e.getUniformLocation("u_model");if(this.gl.uniformMatrix4fv(s,!1,t.toFloat32Array()),void 0!==this.material.diffuseTexture){this.material.diffuseTexture.activateAndBind(0);const t=e.getUniformLocation("u_diffuse");this.gl.uniform1i(t,0)}this.buffer.bind(),this.buffer.draw()}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(e,t,i){this.offset=0,this.location=e,this.size=t,void 0!==i&&(this.offset=i)}clone(){return new s(this.location,this.size,this.offset)}}t.AttributeInfo=s;const r=WebGLRenderingContext;t.GLBuffer=class{constructor(e,t=r.FLOAT,i=r.ARRAY_BUFFER,s=r.TRIANGLES){switch(this.hasArttributeLocation=!1,this.stride=0,this.data=[],this.attributes=[],this.gl=e,this.dataType=t,this.targetBufferType=i,this.mode=s,this.elementSize=0,this.dataType){case r.FLOAT:case r.INT:case r.UNSIGNED_INT:this.typeSize=4;break;case r.SHORT:case r.UNSIGNED_SHORT:this.typeSize=2;break;case r.BYTE:case r.UNSIGNED_BYTE:this.typeSize=1;break;default:throw new Error(`unexpected data type: ${t}`)}const o=e.createBuffer();if(null===o)throw new Error("create buffer error");this.buffer=o}destroy(){this.gl.deleteBuffer(this.buffer)}bind(e=!1){if(this.gl.bindBuffer(this.targetBufferType,this.buffer),this.hasArttributeLocation)for(const t of this.attributes)this.gl.vertexAttribPointer(t.location,t.size,this.dataType,e,this.stride,t.offset*this.typeSize),this.gl.enableVertexAttribArray(t.location)}unbind(){for(const e of this.attributes)this.gl.disableVertexAttribArray(e.location);this.gl.bindBuffer(this.targetBufferType,null)}addAttributeLocation(e){!this.hasArttributeLocation&&(this.hasArttributeLocation=!0);const t=e.clone();t.offset=this.elementSize,this.attributes.push(t),this.elementSize+=t.size,this.stride=this.elementSize*this.typeSize}setData(e){this.clearData(),this.pushBackData(e)}pushBackData(e){for(const t of e)this.data.push(t)}clearData(){this.data.length=0}upload(){let e;switch(this.gl.bindBuffer(this.targetBufferType,this.buffer),this.dataType){case r.FLOAT:e=new Float32Array(this.data);break;case r.INT:e=new Int32Array(this.data);break;case r.UNSIGNED_INT:e=new Uint32Array(this.data);break;case r.SHORT:e=new Int16Array(this.data);break;case r.UNSIGNED_SHORT:e=new Uint16Array(this.data);break;case r.BYTE:e=new Int8Array(this.data);break;case r.UNSIGNED_BYTE:e=new Uint8Array(this.data);break;default:e=null}this.gl.bufferData(this.targetBufferType,e,r.STATIC_DRAW)}draw(){this.targetBufferType===r.ARRAY_BUFFER?this.gl.drawArrays(this.mode,0,this.data.length/this.elementSize):this.targetBufferType===r.ELEMENT_ARRAY_BUFFER&&this.gl.drawElements(this.mode,this.data.length,this.dataType,0)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(2),r=i(1);t.Vertex=class{constructor(e=0,t=0,i=0,o=0,n=0){this.position=s.Vector3.zero,this.texCoords=r.Vector2.zero,this.position.x=e,this.position.y=t,this.position.z=i,this.texCoords.x=o,this.texCoords.y=n}toArray(){let e=[];return e=(e=e.concat(this.position.toArray())).concat(this.texCoords.toArray())}toFloat32Array(){return new Float32Array(this.toArray())}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(1),r=i(0);!function(e){e[e.LEFT=37]="LEFT",e[e.UP=38]="UP",e[e.RIGHT=39]="RIGHT",e[e.DOWN=40]="DOWN"}(t.Keys||(t.Keys={}));class o{constructor(e,t,i){this.leftDown=e,this.rightDown=t,this.position=i}}t.MouseContext=o;class n{static initialize(e){for(let e=0;e<255;e++)n._keys[e]=!1;window.addEventListener("keydown",n.onKeyDown),window.addEventListener("keyup",n.onKeyUp),e.addEventListener("mousemove",n.onMouseMove),e.addEventListener("mousedown",n.onMouseDown),e.addEventListener("mouseup",n.onMouseUp)}static setResolutionScale(e){n._resolutionScale.copyFrom(e)}static isKeyDown(e){return n._keys[e]}static getMousePosition(){return new s.Vector2(this._mouseX,this._mouseY)}static getPreviousMousePosition(){return new s.Vector2(this._previousMouseX,this._previousMouseY)}static onKeyDown(e){return n._keys[e.keyCode]=!0,!0}static onKeyUp(e){return n._keys[e.keyCode]=!1,!0}static onMouseMove(e){n._previousMouseX=n._mouseX,n._previousMouseY=n._mouseY;let t=e.target.getBoundingClientRect();n._mouseX=(e.clientX-Math.round(t.left))*(1/n._resolutionScale.x),n._mouseY=(e.clientY-Math.round(t.top))*(1/n._resolutionScale.y)}static onMouseDown(e){0===e.button?this._leftDown=!0:2===e.button&&(this._rightDown=!0),r.Message.send("MOUSE_DOWN",this,new o(n._leftDown,n._rightDown,n.getMousePosition()))}static onMouseUp(e){0===e.button?this._leftDown=!1:2===e.button&&(this._rightDown=!1),r.Message.send("MOUSE_UP",this,new o(n._leftDown,n._rightDown,n.getMousePosition()))}}t.InputManager=n,n._keys=[],n._leftDown=!1,n._rightDown=!1,n._resolutionScale=s.Vector2.zero},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(e,t){this.assetPath=e,this._player=new Audio(e),this._player.loop=t}get loop(){if(void 0===this._player)throw new Error("this player is not created or destroyed");return this._player.loop}set loop(e){if(void 0===this._player)throw new Error("this player is not created or destroyed");this._player.loop=e}destroy(){this._player=void 0}play(){if(void 0===this._player)throw new Error("this player is not created or destroyed");this._player.paused||this.stop(),this._player.play()}pause(){if(void 0===this._player)throw new Error("this player is not created or destroyed");this._player.pause()}stop(){if(void 0===this._player)throw new Error("this player is not created or destroyed");this._player.pause(),this._player.currentTime=0}}t.SoundEffect=s;class r{static loadSoundFile(e,t,i){r._soundEffects[e]=new s(t,i)}static playSound(e){void 0!==r._soundEffects[e]&&r._soundEffects[e].play()}static pauseSound(e){void 0!==r._soundEffects[e]&&r._soundEffects[e].pause()}static pauseAll(){const e=Object.keys(r._soundEffects);for(const t of e)r._soundEffects[t].pause()}static stopSound(e){void 0!==r._soundEffects[e]&&r._soundEffects[e].stop()}static stopAll(){const e=Object.keys(r._soundEffects);for(const t of e)r._soundEffects[t].stop()}}t.AudioManager=r,r._soundEffects={}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(1),r=i(22);class o{constructor(e=0,t=0,i=0,r=0){this.position=s.Vector2.zero,this.origin=s.Vector2.zero,this.width=0,this.height=0,this.position.x=e,this.position.y=t,this.width=i,this.height=r}get offset(){return new s.Vector2(-this.width*this.origin.x,-this.height*this.origin.y)}setFromJson(e){if(void 0!==e.position&&this.position.setFromJson(e.position),void 0!==e.origin&&this.origin.setFromJson(e.origin),void 0===e.width)throw new Error("Rectangle2D requires width.");if(this.width=Number(e.width),void 0===e.height)throw new Error("Rectangle2D requires height.");this.height=Number(e.height)}intersects(e){if(e instanceof o){let t=this.getExtents(this),i=this.getExtents(e);return t.position.x<=i.width&&t.width>=i.position.x&&t.position.y<=i.height&&t.height>=i.position.y}if(e instanceof r.Circle2D){let t=e.position.x-Math.max(this.position.x,Math.min(e.position.x,this.position.x+this.width)),i=e.position.y-Math.max(this.position.y,Math.min(e.position.y,this.position.y+this.height));if(t*t+i*i<e.radius*e.radius)return!0}return!1}pointInShape(e){let t=this.width<0?this.position.x-this.width:this.position.x,i=this.height<0?this.position.y-this.height:this.position.y,s=this.width<0?this.position.x:this.position.x+this.width,r=this.height<0?this.position.y:this.position.y+this.height;return e.x>=t&&e.x<=s&&e.y>=i&&e.y<=r}getExtents(e){let t=e.width<0?e.position.x-e.width:e.position.x,i=e.height<0?e.position.y-e.height:e.position.y,s=e.width<0?e.position.x:e.position.x+e.width,r=e.height<0?e.position.y:e.position.y+e.height;return new o(t,i,s,r)}}t.Rectangle2D=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(1),r=i(21);class o{constructor(){this.position=s.Vector2.zero,this.origin=s.Vector2.zero,this.radius=0}get offset(){return new s.Vector2(this.radius+this.radius*this.origin.x,this.radius+this.radius*this.origin.y)}setFromJson(e){if(void 0!==e.position&&this.position.setFromJson(e.position),void 0!==e.origin&&this.origin.setFromJson(e.position),void 0===e.radius)throw new Error("Circle2D requires radius.");this.radius=Number(e.radius)}intersects(e){if(e instanceof o){return Math.abs(s.Vector2.distance(e.position,this.position))<=this.radius+e.radius}if(e instanceof r.Rectangle2D){const t=this.position.x-Math.max(e.position.x,Math.min(this.position.x,e.position.x+e.width)),i=this.position.y-Math.max(e.position.y,Math.min(this.position.y,e.position.y+e.height));return t*t+i*i<this.radius*this.radius}return!1}pointInShape(e){return Math.abs(s.Vector2.distance(this.position,e))<=this.radius}}t.Circle2D=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(e,t,i){this.time=e,this.a=t,this.b=i}}t.CollisionData=s;class r{constructor(){}static registerCollisionComponent(e){r._components.push(e)}static unRegisterCollisionComponent(e){const t=r._components.indexOf(e);-1!==t&&r._components.splice(t,1)}static clear(){r._components.length=0}static update(e){r._totalTime+=e;const t=r._components.length;for(let e=0;e<t;e++){const i=r._components[e];for(let o=e+1;o<t;o++){const e=r._components[o];if(i.shape.intersects(e.shape)){let t=!1;for(const s of r._collisionData)if(s.a===i&&s.b===e||s.a===e&&s.b===i){i.onCollisionUpdate(e),e.onCollisionUpdate(i),s.time=r._totalTime,t=!0;break}if(!t){const t=new s(r._totalTime,i,e);i.onCollisionEntry(e),e.onCollisionEntry(i),this._collisionData.push(t)}}}}const i=[];for(const e of r._collisionData)e.time!==r._totalTime&&i.push(e);for(;0!==i.length;){const e=i.shift();if(void 0===e)continue;const t=r._collisionData.indexOf(e);r._collisionData.splice(t,1),e.a.onCollisionExit(e.b),e.b.onCollisionExit(e.a)}}}t.CollisionManager=r,r._totalTime=0,r._components=[],r._collisionData=[]},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(52);class r{static addFont(e,t){r._fonts[e]=new s.BitmapFont(e,t)}static getFont(e){if(void 0===r._fonts[e])throw new Error("A font named "+e+" does not exist.");return r._fonts[e]}static load(){let e=Object.keys(r._fonts);for(let t of e)r._fonts[t].load()}static updateReady(){let e=Object.keys(r._fonts);for(let t of e)if(!r._fonts[t].isLoaded)return console.debug("Font "+t+" is still loading..."),!1;return console.debug("All fonts are loaded"),!0}}t.BitmapFontManager=r,r._fonts={}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(26);let r;window.onload=function(){(r=new s.Engine("viewport")).start()},window.onresize=function(){r.resize()}},function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(r,o){function n(e){try{h(s.next(e))}catch(e){o(e)}}function a(e){try{h(s.throw(e))}catch(e){o(e)}}function h(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,a)}h((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=i(27),o=i(6),n=i(9),a=i(3),h=i(32),d=i(8),c=i(10),l=i(11),u=i(36),_=i(13),m=i(15),p=i(14),f=i(40),g=i(41),w=i(0),y=i(19),v=i(20),b=i(42),x=i(44),M=i(23),E=i(45),A=i(46),S=i(48),C=i(49),T=i(50),F=i(24),P=i(1);t.Engine=class{constructor(e,t=320,i=480){this._previousTime=0,this._isFirstUpdate=!0,this.glContext=r.getWebGLContext(e),this.loop=this.loop.bind(this),this.preloading=this.preloading.bind(this),this._gameWidth=t,this._gameHeight=i,console.log("Engine is created.")}start(){return s(this,void 0,void 0,(function*(){const{gl:e,canvas:t}=this.glContext;void 0!==this._gameWidth&&void 0!==this._gameHeight&&(this._aspect=this._gameWidth/this._gameHeight),_.ComponentManager.registerBuilder(new m.SpriteComponentBuilder),_.ComponentManager.registerBuilder(new b.AnimatedSpriteComponentBuilder),_.ComponentManager.registerBuilder(new x.CollisionComponentBuilder),_.ComponentManager.registerBuilder(new T.BitmapTextComponentBuilder),p.BehaviorManager.registerBuilder(new f.KeyboardMovementBehaviorBuilder),p.BehaviorManager.registerBuilder(new g.RotationBehaviorBuilder),p.BehaviorManager.registerBuilder(new E.MouseClickBehaviorBuilder),p.BehaviorManager.registerBuilder(new A.PlayerBehaviorBuilder),p.BehaviorManager.registerBuilder(new S.ScrollBehaviorBuilder),p.BehaviorManager.registerBuilder(new C.VisibilityOnMessageBehaviorBuilder),a.AssetManager.initialize(),y.InputManager.initialize(t),u.ZoneManager.initialize(e),w.Message.subscribe("MOUSE_UP",this),e.clearColor(146/255,206/255,247/255,1),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA);try{this.shader=yield h.AsyncShaderLoader.load("basic",e,"resource/shader/vertex-source-1.glsl","resource/shader/fragment-source-1.glsl"),this.shader.use(),F.BitmapFontManager.addFont("default","resource/fonts/text.txt"),F.BitmapFontManager.load(),d.MaterialManager.registerMaterial(new c.Material(e,"bg","resource/assets/textures/bg.png",l.Color.white())),d.MaterialManager.registerMaterial(new c.Material(e,"end","resource/assets/textures/end.png",l.Color.white())),d.MaterialManager.registerMaterial(new c.Material(e,"middle","resource/assets/textures/middle.png",l.Color.white())),d.MaterialManager.registerMaterial(new c.Material(e,"grass","resource/assets/textures/grass.png",l.Color.white())),d.MaterialManager.registerMaterial(new c.Material(e,"duck","resource/assets/textures/duck.png",l.Color.white())),d.MaterialManager.registerMaterial(new c.Material(e,"playbtn","resource/assets/textures/playbtn.png",l.Color.white())),d.MaterialManager.registerMaterial(new c.Material(e,"restartbtn","resource/assets/textures/restartbtn.png",l.Color.white())),d.MaterialManager.registerMaterial(new c.Material(e,"score","resource/assets/textures/score.png",l.Color.white())),d.MaterialManager.registerMaterial(new c.Material(e,"title","resource/assets/textures/title.png",l.Color.white())),d.MaterialManager.registerMaterial(new c.Material(e,"tutorial","resource/assets/textures/tutorial.png",l.Color.white())),v.AudioManager.loadSoundFile("flap","resource/sounds/flap.mp3",!1),v.AudioManager.loadSoundFile("ting","resource/sounds/ting.mp3",!1),v.AudioManager.loadSoundFile("dead","resource/sounds/dead.mp3",!1)}catch(e){throw new Error(`scene load error: ${e}`)}this.projection=o.Matrix4x4.orthographic(0,t.width,t.height,0,-100,100),this.resize(),this.preloading(),console.log("Engine is started.")}))}preloading(){const{gl:e}=this.glContext;n.MessageBus.update(0),F.BitmapFontManager.updateReady()?(u.ZoneManager.changeZone(e,0),this.loop()):requestAnimationFrame(this.preloading)}loop(){this._isFirstUpdate&&(this._isFirstUpdate=!1),this.update(),this.render(),requestAnimationFrame(this.loop)}update(){const e=performance.now()-this._previousTime;n.MessageBus.update(e),u.ZoneManager.update(e),M.CollisionManager.update(e),this._previousTime=performance.now()}render(){const{gl:e}=this.glContext;if(e.clear(e.COLOR_BUFFER_BIT),void 0!==this.shader&&void 0!==this.projection){u.ZoneManager.render(this.shader);const t=this.shader.getUniformLocation("u_projection");e.uniformMatrix4fv(t,!1,new Float32Array(this.projection.data))}}resize(){const{gl:e,canvas:t}=this.glContext;if(void 0===this._gameWidth||void 0===this._gameHeight)t.width=window.innerWidth,t.height=window.innerHeight,e.viewport(0,0,window.innerWidth,window.innerHeight),this.projection=o.Matrix4x4.orthographic(0,window.innerWidth,window.innerHeight,0,-100,100);else{let i=window.innerWidth,s=window.innerHeight,r=i/s,n=document.getElementById("gameArea");if(null===n)throw new Error("game area must defined.");r>this._aspect?(i=s*this._aspect,n.style.height=s+"px",n.style.width=i+"px"):(s=i/this._aspect,n.style.width=i+"px",n.style.height=s+"px"),n.style.marginTop=-s/2+"px",n.style.marginLeft=-i/2+"px",t.width=i,t.height=s,e.viewport(0,0,i,s),this.projection=o.Matrix4x4.orthographic(0,this._gameWidth,this._gameHeight,0,-100,100);let a=new P.Vector2(i/this._gameWidth,s/this._gameHeight);y.InputManager.setResolutionScale(a)}}onMessage(e){if("MOUSE_UP"===e.code){const t=e.context;document.title=`Pos: [${t.position.x},${t.position.y}]`}}}},function(e,t,i){"use strict";let s;function r(e){if(void 0!==s)return s;let t,i;if(void 0!==e){if(null==(t=document.getElementById(e)))throw new Error(`Can not find a cavans by id: ${e}!`)}else(t=document.createElement("canvas")).innerText="please check if your browser support webgl.",document.body.appendChild(t);if(null==(i=t.getContext("webgl")||t.getContext("experimental-webgl")))throw new Error("Can not get webgl context!");return s={canvas:t,gl:i}}Object.defineProperty(t,"__esModule",{value:!0}),t.getWebGLContext=r,t.default={getWebGLContext:r}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.MessageSubscriptionNode=class{constructor(e,t){this.message=e,this.handler=t}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(3);class r{constructor(e,t){this.name=e,this.data=t}get width(){return this.data.width}get height(){return this.data.height}}t.ImageAsset=r;t.ImageAssetLoader=class{get supportedExtensions(){return["png","gif","jpg"]}loadAsset(e){const t=new Image;t.onload=this.onImageLoaded.bind(this,e,t),/^https?:\/\//.test(e)&&new URL(e).origin!==window.location.origin&&(t.crossOrigin=""),t.src=e}onImageLoaded(e,t){console.log("onImageLoaded: assetName/image",e,t);const i=new r(e,t);s.AssetManager.onAssetLoaded(i)}}},function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(r,o){function n(e){try{h(s.next(e))}catch(e){o(e)}}function a(e){try{h(s.throw(e))}catch(e){o(e)}}function h(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,a)}h((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=i(7),o=i(3);class n{constructor(e,t){this.name=e,this.data=t}}t.JsonAsset=n;t.JsonAssetLoader=class{get supportedExtensions(){return["json"]}loadAsset(e){return s(this,void 0,void 0,(function*(){const{response:t}=yield r.HttpClient.get(e);this.onJsonLoaded(e,t)}))}onJsonLoaded(e,t){console.log("onJsonLoaded: assetName/assetJson",e,t);const i=JSON.parse(t),s=new n(e,i);o.AssetManager.onAssetLoaded(s)}}},function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(r,o){function n(e){try{h(s.next(e))}catch(e){o(e)}}function a(e){try{h(s.throw(e))}catch(e){o(e)}}function h(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,a)}h((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=i(3),o=i(7);class n{constructor(e,t){this.name=e,this.data=t}}t.TextAsset=n;t.TextAssetLoader=class{get supportedExtensions(){return["txt"]}loadAsset(e){return s(this,void 0,void 0,(function*(){const{response:t}=yield o.HttpClient.get(e);this.onTextLoaded(e,t)}))}onTextLoaded(e,t){const i=new n(e,t);r.AssetManager.onAssetLoaded(i)}}},function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(r,o){function n(e){try{h(s.next(e))}catch(e){o(e)}}function a(e){try{h(s.throw(e))}catch(e){o(e)}}function h(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,a)}h((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=i(33),o=i(7);class n extends r.Shader{static load(e,t,i,n){return s(this,void 0,void 0,(function*(){const{response:s}=yield o.HttpClient.get(i),{response:a}=yield o.HttpClient.get(n),h=new r.Shader(e,t);return h.load(s,a),h}))}}t.AsyncShaderLoader=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=WebGLRenderingContext;t.Shader=class{constructor(e,t){this.attributes={},this.uniforms={},this._name=e,this.gl=t}get name(){return this._name}load(e,t){const i=this.loadShader(e,this.gl.VERTEX_SHADER),s=this.loadShader(t,this.gl.FRAGMENT_SHADER);this.program=this.createProgram(i,s),this.detectAttributes(),this.detectUniforms()}use(){if(void 0===this.program)throw new Error("program is undefined: this shader maybe not loaded.");this.gl.useProgram(this.program)}loadShader(e,t){const i=this.gl.createShader(t);if(null===i)throw new Error(`some error ocurred when create shader, type: ${t}, source: ${e}`);this.gl.shaderSource(i,e),this.gl.compileShader(i);const s=this.gl.getShaderInfoLog(i);if(null!==s&&s.trim().length>0)throw new Error(`some error ocurred when compile shader, error: ${s}, type: ${t}, source: ${e}`);return i}createProgram(e,t){const i=this.gl.createProgram();if(null===i)throw new Error(`some error ocurred when create program, shader name: ${this._name}`);this.gl.attachShader(i,e),this.gl.attachShader(i,t),this.gl.linkProgram(i);const s=this.gl.getProgramInfoLog(i);if(null!==s&&s.trim().length>0)throw new Error(`some error ocurred when link program, error: ${s}, shader name: ${this._name}`);return i}getAttributeLoaction(e){const t=this.attributes[e];if(void 0===t)throw new Error(`can not find attribute named '${e}' in shader named '${this._name}.'`);return t}getUniformLocation(e){const t=this.uniforms[e];if(void 0===t)throw new Error(`can not find uniform named '${e}' in shader named '${this._name}.'`);return t}detectAttributes(){if(void 0===this.program)throw new Error("program is undefined: this shader maybe not loaded.");const e=this.gl.getProgramParameter(this.program,s.ACTIVE_ATTRIBUTES);for(let t=0;t<e;t++){const e=this.gl.getActiveAttrib(this.program,t);if(!e)break;this.attributes[e.name]=this.gl.getAttribLocation(this.program,e.name)}}detectUniforms(){if(void 0===this.program)throw new Error("program is undefined: this shader maybe not loaded.");const e=this.gl.getProgramParameter(this.program,s.ACTIVE_UNIFORMS);for(let t=0;t<e;t++){const e=this.gl.getActiveUniform(this.program,t);if(!e)break;this.uniforms[e.name]=this.gl.getUniformLocation(this.program,e.name)}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(35);class r{constructor(e){this.referenceCount=1,this.texture=e}}class o{constructor(){}static getTexture(e,t){if(void 0===o._textures[t]){const i=new s.Texture(e,t);o._textures[t]=new r(i)}else o._textures[t].referenceCount++;return o._textures[t].texture}static releaseTexture(e){void 0===o._textures[e]?console.warn(`texture named ${e} not exist.`):(o._textures[e].referenceCount--,o._textures[e].referenceCount<1&&(o._textures[e].texture.destroy(),delete o._textures[e]))}}t.TextureManager=o,o._textures={}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(3),r=i(0),o=0,n=0,a=new Uint8Array([255,255,255,255]);t.Texture=class{constructor(e,t,i=1,h=1){this._isLoaded=!1,this._gl=e,this._name=t,this._width=i,this._height=h;const d=e.createTexture();if(null===d)throw new Error("create texture error.");this._handle=d,this.bind(),e.texImage2D(e.TEXTURE_2D,o,e.RGBA,1,1,n,e.RGBA,e.UNSIGNED_BYTE,a);const c=s.AssetManager.getAsset(this._name);void 0!==c?this.loadTextureFromAsset(c):r.Message.subscribe(s.MESSAGE_ASSET_LOADER_ASSET_LOADED+this._name,this)}get name(){return this._name}get isLoaded(){return this._isLoaded}get width(){return this._width}get height(){return this._height}destroy(){this._gl.deleteTexture(this._handle)}activateAndBind(e=0){this._gl.activeTexture(this._gl.TEXTURE0+e),this.bind()}bind(){this._gl.bindTexture(this._gl.TEXTURE_2D,this._handle)}unbind(){this._gl.bindTexture(this._gl.TEXTURE_2D,null)}onMessage(e){e.code===s.MESSAGE_ASSET_LOADER_ASSET_LOADED+this._name&&this.loadTextureFromAsset(e.context)}loadTextureFromAsset(e){this._width=e.width,this._height=e.height,this.bind();const{_gl:t}=this;t.texImage2D(t.TEXTURE_2D,o,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e.data),this.isPowerOf2()?t.generateMipmap(t.TEXTURE_2D):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR))}isPowerOf2(){return this.isValuePowerOf2(this._width)&&this.isValuePowerOf2(this._height)}isValuePowerOf2(e){return 0==(e&e-1)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(37),r=i(3),o=i(0);class n{constructor(e){this._gl=e}static initialize(e){n._inst=new n(e),n._registeredZones[0]="resource/zones/testZone.json"}static changeZone(e,t){if(void 0!==n._acitveZone&&(n._acitveZone.onDeactivated(),n._acitveZone.unload(),n._acitveZone=void 0),void 0===n._registeredZones[t])throw new Error(`Zone id: ${t} does not exist.`);if(r.AssetManager.isAssetLoaded(n._registeredZones[t])){const i=r.AssetManager.getAsset(n._registeredZones[t]);if(void 0===i)throw new Error(`can not find asset with zoneId: ${t}`);n.loadZone(e,i)}else o.Message.subscribe(r.MESSAGE_ASSET_LOADER_ASSET_LOADED+n._registeredZones[t],n._inst),r.AssetManager.loadAsset(n._registeredZones[t])}static update(e){void 0!==n._acitveZone&&n._acitveZone.update(e)}static render(e){void 0!==n._acitveZone&&n._acitveZone.render(e)}onMessage(e){if(-1!==e.code.indexOf(r.MESSAGE_ASSET_LOADER_ASSET_LOADED)){console.log(`zone loaded: ${e.code}`);const t=e.context;n.loadZone(this._gl,t)}}static loadZone(e,t){console.log(`loading zone: ${t.name}`);const i=t.data;let r,o,a;if(void 0===i.id)throw new Error("zone file format error: zone id not present.");if(r=Number(i.id),void 0===i.name)throw new Error("zone file format error: zone name not present.");o=String(i.name),a=void 0!==i.description?String(i.description):"",n._acitveZone=new s.Zone(e,r,o,a),n._acitveZone.initialize(i),n._acitveZone.onActivated(),n._acitveZone.load()}}t.ZoneManager=n,n._registeredZones={}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(38),r=i(12),o=i(13),n=i(14);var a;!function(e){e[e.UNINITIALIZED=0]="UNINITIALIZED",e[e.LOADING=1]="LOADING",e[e.UPDATING=2]="UPDATING"}(a=t.ZoneState||(t.ZoneState={}));t.Zone=class{constructor(e,t,i,r){this._state=a.UNINITIALIZED,this._globalID=-1,this._gl=e,this._id=t,this._name=i,this._description=r,this._scene=new s.Scene}initialize(e){if(void 0===e.objects)throw new Error("Zone initialization error: objects not present.");for(const t in e.objects)if(e.objects.hasOwnProperty(t)){const i=e.objects[t];this.loadSimObject(i,this._scene.root)}}loadSimObject(e,t){let i;if(void 0===e.name)throw new Error("SimObject name is undefined");i=String(e.name),this._globalID++;const s=new r.SimObject(this._globalID,i,this._scene);if(void 0!==e.transform&&s.transform.setFromJson(e.transform),void 0!==e.components){for(const t in e.components)if(e.components.hasOwnProperty(t)){const i=e.components[t];let r=o.ComponentManager.extractComponent(this._gl,i);s.addComponent(r)}}else console.log(`No components in ${i}`);if(void 0!==e.behaviors)for(let t in e.behaviors){const i=e.behaviors[t],r=n.BehaviorManager.extractBehavior(i);s.addBehavior(r)}if(void 0!==e.children)for(const t in e.children)if(e.children.hasOwnProperty(t)){const i=e.children[t];this.loadSimObject(i,s)}void 0!==t&&t.addChild(s)}get id(){return this._id}get name(){return this._name}get description(){return this._description}get scene(){return this._scene}load(){this._state=a.LOADING,this._scene.load(),this._scene.root.updateReady(),this._state=a.UPDATING}unload(){}update(e){this._state===a.UPDATING&&this._scene.update(e)}render(e){this._state===a.UPDATING&&this._scene.render(e)}onActivated(){}onDeactivated(){}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(12);t.Scene=class{constructor(){this._root=new s.SimObject(0,"__root__",this)}get root(){return this._root}get isLoaded(){return this._root.isLoaded}addObject(e){this._root.addChild(e)}getObjectByName(e){return this._root.getObjectByName(e)}load(){this._root.load()}update(e){this._root.update(e)}render(e){this._root.render(e)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(2),r=i(6);t.Transform=class{constructor(){this.position=s.Vector3.zero,this.rotation=s.Vector3.zero,this.scale=s.Vector3.one}copyFrom(e){this.position.copyFrom(e.position),this.rotation.copyFrom(e.rotation),this.scale.copyFrom(e.scale)}getTransformationMatrix(){let e=r.Matrix4x4.translation(this.position),t=r.Matrix4x4.rotationXYZ(this.rotation.x,this.rotation.y,this.rotation.z),i=r.Matrix4x4.scale(this.scale);return r.Matrix4x4.multiply(r.Matrix4x4.multiply(e,t),i)}setFromJson(e){void 0!==e.position&&this.position.setFromJson(e.position),void 0!==e.rotation&&this.rotation.setFromJson(e.rotation),void 0!==e.scale&&this.scale.setFromJson(e.scale)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(4),r=i(19);class o{constructor(){this.speed=.1}setFromJson(e){if(void 0===e.name)throw new Error("name must be defined in behavior data.");this.name=String(e.name),void 0!==e.speed&&(this.speed=Number(e.speed))}}t.KeyboardMovementBehaviorData=o;t.KeyboardMovementBehaviorBuilder=class{get type(){return"keyboardMovement"}buildFromJson(e){let t=new o;return t.setFromJson(e),new n(t)}};class n extends s.BaseBehavior{constructor(e){super(e),this.speed=.1,this.speed=e.speed}update(e){void 0!==this._owner?(r.InputManager.isKeyDown(r.Keys.LEFT)&&(this._owner.transform.position.x-=this.speed),r.InputManager.isKeyDown(r.Keys.RIGHT)&&(this._owner.transform.position.x+=this.speed),r.InputManager.isKeyDown(r.Keys.UP)&&(this._owner.transform.position.y-=this.speed),r.InputManager.isKeyDown(r.Keys.DOWN)&&(this._owner.transform.position.y+=this.speed),super.update(e)):console.log("owner is undefined.")}}t.KeyboardMovementBehavior=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(2),r=i(4);class o{constructor(){this.rotation=s.Vector3.zero}setFromJson(e){if(void 0===e.name)throw new Error("name must be defined in behavior data.");this.name=String(e.name),void 0!==e.rotation&&this.rotation.setFromJson(e.rotation)}}t.RotationBehaviorData=o;t.RotationBehaviorBuilder=class{get type(){return"rotation"}buildFromJson(e){const t=new o;return t.setFromJson(e),new n(t)}};class n extends r.BaseBehavior{constructor(e){super(e),this._rotation=e.rotation}update(e){void 0!==this._owner?(this._owner.transform.rotation.add(this._rotation),super.update(e)):console.log("owner is undefined.")}}t.RotationBehavior=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(15),r=i(5),o=i(43);class n extends s.SpriteComponentData{constructor(){super(...arguments),this.autoPlay=!0,this.frameSequence=[],this.frameTime=33}setFromJson(e){if(super.setFromJson(e),void 0!==e.autoPlay&&(this.autoPlay=Boolean(e.autoPlay)),void 0===e.frameWidth)throw new Error('AnimatedSpriteComponentData requires "frameWidth".');if(this.frameWidth=Number(e.frameWidth),void 0===e.frameHeight)throw new Error('AnimatedSpriteComponentData requires "frameHeight".');if(this.frameHeight=Number(e.frameHeight),void 0===e.frameCount)throw new Error('AnimatedSpriteComponentData requires "frameCount".');if(this.frameCount=Number(e.frameCount),void 0===e.frameSequence)throw new Error('AnimatedSpriteComponentData requires "frameSequence".');this.frameSequence=e.frameSequence}}t.AnimatedSpriteComponentData=n;t.AnimatedSpriteComponentBuilder=class{get type(){return"animatedSprite"}buildFromJson(e,t){const i=new n;return i.setFromJson(t),new a(e,i)}};class a extends r.BaseComponent{constructor(e,t){if(super(t),this._autoPlay=!0,void 0===this.name||void 0===t.materialName)throw new Error("create AnimatedSpriteComponent error, name or materialName undefined.");void 0!==t.autoPlay&&(this._autoPlay=Boolean(t.autoPlay));const i=new o.AnimatedSpriteInfo;i.name=name,i.materialName=t.materialName,void 0!==t.frameWidth&&(i.frameWidth=t.frameWidth),void 0!==t.frameHeight&&(i.frameHeight=t.frameHeight),void 0!==t.frameWidth&&(i.width=t.frameWidth),void 0!==t.frameHeight&&(i.height=t.frameHeight),void 0!==t.frameCount&&(i.frameCount=t.frameCount),i.frameSequence=t.frameSequence,i.frameTime=t.frameTime,this._sprite=new o.AnimatedSprite(e,i)}get isPlaying(){return this._sprite.isPlaying}load(){this._sprite.load()}updateReady(){this._autoPlay||this._sprite.stop()}update(e){this._sprite.update(e),super.update(e)}render(e){if(void 0===this.owner)throw new Error("owner is undefined.");this._sprite.draw(e,this.owner.worldMatrix),super.render(e)}play(){this._sprite.play()}stop(){this._sprite.stop()}setFrame(e){this._sprite.setFrame(e)}}t.AnimatedSpriteComponent=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(1),r=i(16),o=i(0),n=i(3),a=i(8);class h{constructor(e,t){this.min=e,this.max=t}}t.AnimatedSpriteInfo=class{constructor(){this.width=100,this.height=100,this.frameWidth=10,this.frameHeight=10,this.frameCount=1,this.frameSequence=[],this.frameTime=60}};class d extends r.Sprite{constructor(e,t){super(e,t.name,t.materialName,t.width,t.height),this._frameTime=333,this._frameUVs=[],this._currentFrame=0,this._currentTime=0,this._assetLoaded=!1,this._assetWidth=2,this._assetHeight=2,this._isPlaying=!0,this._frameWidth=t.frameWidth,this._frameHeight=t.frameHeight,this._frameCount=t.frameCount,this._frameSequence=t.frameSequence,this._frameTime=t.frameTime,o.Message.subscribe(n.MESSAGE_ASSET_LOADER_ASSET_LOADED+this.material.diffuseTextureName,this)}get isPlaying(){return this._isPlaying}play(){this._isPlaying=!0}stop(){this._isPlaying=!1}destroy(){super.destroy()}setFrame(e){if(e>=this._frameCount)throw new Error(`Frame is out of range: ${e}, frame count: ${this._frameCount}`);this._currentFrame=e}onMessage(e){if(e.code===n.MESSAGE_ASSET_LOADER_ASSET_LOADED+this.material.diffuseTextureName){this._assetLoaded=!0;const t=e.context;this._assetWidth=t.width,this._assetHeight=t.height,this.caculateUVs()}}load(){super.load(),this._assetLoaded||this.setupFromMaterial()}update(e){if(this._assetLoaded){if(this._isPlaying){if(this._currentTime+=e,this._currentTime>this._frameTime){if(void 0===this.buffer)throw new Error("buffer is not initialized!");this._currentFrame++,this._currentTime=0,this._currentFrame>=this._frameSequence.length&&(this._currentFrame=0);const e=this._frameSequence[this._currentFrame];this.vertices[0].texCoords.copyFrom(this._frameUVs[e].min),this.vertices[1].texCoords.copyFrom(new s.Vector2(this._frameUVs[e].min.x,this._frameUVs[e].max.y)),this.vertices[2].texCoords.copyFrom(this._frameUVs[e].max),this.vertices[3].texCoords.copyFrom(this._frameUVs[e].max),this.vertices[4].texCoords.copyFrom(new s.Vector2(this._frameUVs[e].max.x,this._frameUVs[e].min.y)),this.vertices[5].texCoords.copyFrom(this._frameUVs[e].min);for(const e of this.vertices)this.buffer.pushBackData(e.toArray());this.buffer.upload(),this.buffer.unbind()}super.update(e)}}else this.setupFromMaterial()}caculateUVs(){let e=0,t=0;for(let i=0;i<this._frameCount;i++){(e+=i*this._frameWidth)>this._assetWidth&&(t++,e=0);const r=i*this._frameWidth/this._assetWidth,o=t*this._frameHeight/this._assetHeight,n=new s.Vector2(r,o),a=(i*this._frameWidth+this._frameWidth)/this._assetWidth,d=(t*this._frameHeight+this._frameHeight)/this._assetHeight,c=new s.Vector2(a,d);this._frameUVs.push(new h(n,c))}}setupFromMaterial(){if(!this._assetLoaded){const e=a.MaterialManager.getMaterial(this.materialName);e&&e.diffuseTexture&&e.diffuseTexture.isLoaded&&n.AssetManager.isAssetLoaded(e.diffuseTextureName)&&(this._assetWidth=e.diffuseTexture.width,this._assetHeight=e.diffuseTexture.height,this._assetLoaded=!0,this.caculateUVs())}}}t.AnimatedSprite=d},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(21),r=i(22),o=i(5),n=i(23);class a{setFromJson(e){if(void 0!==e.name&&(this.name=String(e.name)),void 0===e.shape)throw new Error('CollisionComponentData requires "shape".');{if(void 0===e.shape.type)throw new Error('CollisionComponentData requires "shape.type".');const t=String(e.shape.type).toLowerCase();switch(t){case"rectangle":this.shape=new s.Rectangle2D;break;case"circle":this.shape=new r.Circle2D;break;default:throw new Error(`Unsupported shape type: ${t}.`)}this.shape.setFromJson(e.shape)}}}t.CollisionComponentData=a;t.CollisionComponentBuilder=class{get type(){return"collision"}buildFromJson(e,t){const i=new a;return i.setFromJson(t),new h(i)}};class h extends o.BaseComponent{constructor(e){if(super(e),void 0===e.shape)throw new Error("shape of CollisionComponentData is undefined.");this._shape=e.shape}get shape(){return this._shape}load(){super.load(),this._shape.position.copyFrom(this.owner.transform.position.toVector2().add(this._shape.offset)),n.CollisionManager.registerCollisionComponent(this)}update(e){this._shape.position.copyFrom(this.owner.transform.position.toVector2().add(this._shape.offset)),super.update(e)}render(e){super.render(e)}onCollisionEntry(e){console.log("onCollisionEntry",this,e)}onCollisionUpdate(e){}onCollisionExit(e){console.log("onCollisionExit",this,e)}}t.CollisionComponent=h},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(4),r=i(0);class o{constructor(){this.width=0,this.height=0}setFromJson(e){if(void 0===e.name)throw new Error("name must be defined in behavior data.");if(this.name=String(e.name),void 0===e.width)throw new Error("width must be defined in behavior data.");if(this.width=Number(e.width),void 0===e.height)throw new Error("height must be defined in behavior data.");if(this.height=Number(e.height),void 0===e.messageCode)throw new Error("messageCode must be defined in behavior data.");this.messageCode=String(e.messageCode)}}t.MouseClickBehaviorData=o;t.MouseClickBehaviorBuilder=class{get type(){return"mouseClick"}buildFromJson(e){const t=new o;return t.setFromJson(e),new n(t)}};class n extends s.BaseBehavior{constructor(e){if(super(e),this._width=e.width,this._height=e.height,void 0===e.messageCode)throw new Error("messageCode is undefined.");this._messageCode=e.messageCode,r.Message.subscribe("MOUSE_UP",this)}onMessage(e){if("MOUSE_UP"===e.code&&!this._owner.isVisible)return;const t=e.context,i=this._owner.getWorldPosition(),s=i.x+this._width,o=i.y+this._height;t.position.x>=i.x&&t.position.x<s&&t.position.y>=i.y&&t.position.y<o&&r.Message.send(this._messageCode,this)}}t.MouseClickBehavior=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(1),r=i(4),o=i(2),n=i(0),a=i(47),h=i(20);class d{constructor(){this.acceleration=new s.Vector2(0,920)}setFromJson(e){if(void 0===e.name)throw new Error("Name must be defined in behavior data.");if(this.name=String(e.name),void 0!==e.acceleration&&this.acceleration.setFromJson(e.acceleration),void 0===e.animatedSpriteName)throw new Error("animatedSpriteName must be defined in behavior data.");if(this.animatedSpriteName=String(e.animatedSpriteName),void 0===e.playerCollisionComponent)throw new Error("playerCollisionComponent must be defined in behavior data.");if(this.playerCollisionComponent=String(e.playerCollisionComponent),void 0===e.groundCollisionComponent)throw new Error("groundCollisionComponent must be defined in behavior data.");if(this.groundCollisionComponent=String(e.groundCollisionComponent),void 0===e.scoreCollisionComponent)throw new Error("scoreCollisionComponent must be defined in behavior data.");this.scoreCollisionComponent=String(e.scoreCollisionComponent)}}t.PlayerBehaviorData=d;t.PlayerBehaviorBuilder=class{get type(){return"player"}buildFromJson(e){const t=new d;return t.setFromJson(e),new c(t)}};class c extends r.BaseBehavior{constructor(e){if(super(e),this._velocity=s.Vector2.zero,this._isAlive=!0,this._isPlaying=!1,this._initialPosition=o.Vector3.zero,this._score=0,this._highScore=0,this._pipeNames=["pipe1Collision_end","pipe1Collision_middle_top","pipe1Collision_endneg","pipe1Collision_middle_bottom"],this._acceleration=e.acceleration,void 0===e.animatedSpriteName)throw new Error("animatedSpriteName must be defined in behavior data.");if(this._animatedSpriteName=String(e.animatedSpriteName),void 0===e.playerCollisionComponent)throw new Error("playerCollisionComponent must be defined in behavior data.");if(this._playerCollisionComponent=String(e.playerCollisionComponent),void 0===e.groundCollisionComponent)throw new Error("groundCollisionComponent must be defined in behavior data.");if(this._groundCollisionComponent=String(e.groundCollisionComponent),void 0===e.scoreCollisionComponent)throw new Error("scoreCollisionComponent must be defined in behavior data.");this._scoreCollisionComponent=String(e.scoreCollisionComponent),n.Message.subscribe("MOUSE_DOWN",this),n.Message.subscribe("COLLISION_ENTRY",this),n.Message.subscribe("GAME_READY",this),n.Message.subscribe("GAME_RESET",this),n.Message.subscribe("GAME_START",this),n.Message.subscribe("PLAYER_DIED",this)}updateReady(){if(void 0===this._owner)throw new Error("owner is undefined.");const e=this._owner.getComponentByName(this._animatedSpriteName);if(void 0===e)throw new Error(`AnimatedSpriteComponent named '${this._animatedSpriteName}' is not exist in the owner.`);this._sprite=e,this._sprite.setFrame(0),this._initialPosition.copyFrom(this._owner.transform.position)}update(e){if(void 0===this._owner)throw new Error("owner is undefined.");if(void 0===this._sprite)throw new Error("sprite is undefined.");const t=e/1e3;this._isPlaying&&this._velocity.add(this._acceleration.clone().scale(t)),this._velocity.y>400&&(this._velocity.y=400),this._owner.transform.position.y<-13&&(this._owner.transform.position.y=-13,this._velocity.y=0),this._owner.transform.position.add(this._velocity.clone().scale(t).toVector3()),this._velocity.y<0&&(this._owner.transform.rotation.z-=a.MathUtils.degToRad(600)*t,this._owner.transform.rotation.z<a.MathUtils.degToRad(-20)&&(this._owner.transform.rotation.z=a.MathUtils.degToRad(-20))),!this.isFalling()&&this._isAlive||(this._owner.transform.rotation.z+=a.MathUtils.degToRad(480)*t,this._owner.transform.rotation.z>a.MathUtils.degToRad(90)&&(this._owner.transform.rotation.z=a.MathUtils.degToRad(90))),this.shouldNotFlap()?this._sprite&&this._sprite.stop():this._sprite&&!this._sprite.isPlaying&&this._sprite.play(),super.update(e)}onMessage(e){switch(e.code){case"MOUSE_DOWN":this.onFlap();break;case"COLLISION_ENTRY":let t=e.context;if(t.a.name!==this._playerCollisionComponent&&t.b.name!==this._playerCollisionComponent)return;t.a.name===this._groundCollisionComponent||t.b.name===this._groundCollisionComponent?(this.die(),this.decelerate()):-1!==this._pipeNames.indexOf(t.a.name)||-1!==this._pipeNames.indexOf(t.b.name)?this.die():t.a.name!==this._scoreCollisionComponent&&t.b.name!==this._scoreCollisionComponent||this._isAlive&&this._isPlaying&&(this.setScore(this._score+1),h.AudioManager.playSound("ting"));break;case"GAME_RESET":n.Message.send("GAME_HIDE",this),n.Message.send("RESET_HIDE",this),n.Message.send("SPLASH_HIDE",this),n.Message.send("TUTORIAL_SHOW",this),this.reset();break;case"GAME_START":n.Message.send("GAME_SHOW",this),n.Message.send("RESET_HIDE",this),n.Message.send("SPLASH_HIDE",this),n.Message.send("TUTORIAL_HIDE",this),this._isPlaying=!0,this._isAlive=!0,this.start();break;case"GAME_READY":n.Message.send("RESET_HIDE",this),n.Message.send("TUTORIAL_HIDE",this),n.Message.send("GAME_HIDE",this),n.Message.send("SPLASH_SHOW",this);break;case"PLAYER_DIED":n.Message.send("RESET_SHOW",this)}}isFalling(){return this._velocity.y>220}shouldNotFlap(){return!this._isPlaying||this._velocity.y>220||!this._isAlive}die(){this._isAlive&&(this._isAlive=!1,h.AudioManager.playSound("dead"),n.Message.send("PLAYER_DIED",this))}reset(){if(void 0===this._sprite||void 0===this._sprite.owner)throw new Error("AnimatedSpriteComponent or owner is undefined.");this._isAlive=!0,this._isPlaying=!1,this._sprite.owner.transform.position.copyFrom(this._initialPosition),this._sprite.owner.transform.rotation.z=0,this.setScore(0),this._velocity.set(0,0),this._acceleration.set(0,920),this._sprite.play()}start(){this._isPlaying=!0,n.Message.send("PLAYER_RESET",this)}decelerate(){this._acceleration.y=0,this._velocity.y=0}onFlap(){this._isAlive&&this._isPlaying&&(this._velocity.y=-280,h.AudioManager.playSound("flap"))}setScore(e){this._score=e,n.Message.send("counterText:SetText",this,this._score),n.Message.send("scoreText:SetText",this,this._score),this._score>this._highScore&&(this._highScore=this._score,n.Message.send("bestText:SetText",this,this._highScore))}}t.PlayerBehavior=c},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.MathUtils=class{static clamp(e,t,i){return e<t?t:e>i?i:e}static degToRad(e){return e*Math.PI/180}static radToDeg(e){return 180*e/Math.PI}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(1),r=i(4),o=i(0);class n{constructor(){this.velocity=s.Vector2.zero,this.minPosition=s.Vector2.zero,this.resetPosition=s.Vector2.zero,this.minResetY=0,this.maxResetY=0}setFromJson(e){if(void 0===e.name)throw new Error("Name must be defined in behavior data.");if(this.name=String(e.name),void 0!==e.startMessage&&(this.startMessage=String(e.startMessage)),void 0!==e.stopMessage&&(this.stopMessage=String(e.stopMessage)),void 0!==e.resetMessage&&(this.resetMessage=String(e.resetMessage)),void 0===e.velocity)throw new Error("ScrollBehaviorData requires property 'velocity' to be defined!");if(this.velocity.setFromJson(e.velocity),void 0===e.minPosition)throw new Error("ScrollBehaviorData requires property 'minPosition' to be defined!");if(this.minPosition.setFromJson(e.minPosition),void 0===e.resetPosition)throw new Error("ScrollBehaviorData requires property 'resetPosition' to be defined!");this.resetPosition.setFromJson(e.resetPosition),void 0!==e.minResetY&&(this.minResetY=Number(e.minResetY)),void 0!==e.maxResetY&&(this.maxResetY=Number(e.maxResetY))}}t.ScrollBehaviorData=n;t.ScrollBehaviorBuilder=class{get type(){return"scroll"}buildFromJson(e){let t=new n;return t.setFromJson(e),new a(t)}};class a extends r.BaseBehavior{constructor(e){super(e),this._velocity=s.Vector2.zero,this._minPosition=s.Vector2.zero,this._resetPosition=s.Vector2.zero,this._isScrolling=!1,this._initialPosition=s.Vector2.zero,this._minResetY=0,this._maxResetY=0,this._velocity.copyFrom(e.velocity),this._minPosition.copyFrom(e.minPosition),this._resetPosition.copyFrom(e.resetPosition),this._startMessage=e.startMessage,this._stopMessage=e.stopMessage,this._resetMessage=e.resetMessage,void 0!==e.minResetY&&(this._minResetY=e.minResetY),void 0!==e.maxResetY&&(this._maxResetY=e.maxResetY)}updateReady(){if(super.updateReady(),void 0!==this._startMessage&&o.Message.subscribe(this._startMessage,this),void 0!==this._stopMessage&&o.Message.subscribe(this._stopMessage,this),void 0!==this._resetMessage&&o.Message.subscribe(this._resetMessage,this),void 0===this._owner)throw new Error("owner is undefined.");this._initialPosition.copyFrom(this._owner.transform.position.toVector2())}update(e){if(this._isScrolling){if(void 0===this._owner)throw new Error("owner is undefined.");this._owner.transform.position.add(this._velocity.clone().scale(e/1e3).toVector3());let t=void 0!==this._minResetY&&void 0!==this._maxResetY;this._owner.transform.position.x<=this._minPosition.x&&(t||!t&&this._owner.transform.position.y<=this._minPosition.y)&&this.reset()}}onMessage(e){e.code===this._startMessage?this._isScrolling=!0:e.code===this._stopMessage?this._isScrolling=!1:e.code===this._resetMessage&&this.initial()}reset(){if(void 0===this._owner)throw new Error("owner is undefined.");this._owner.transform.position.copyFrom(this._resetPosition.toVector3()),void 0!==this._minResetY&&void 0!==this._maxResetY?this._owner.transform.position.set(this._resetPosition.x,this.getRandomY()):this._owner.transform.position.copyFrom(this._resetPosition.toVector3())}getRandomY(){return Math.floor(Math.random()*(this._maxResetY-this._minResetY+1))+this._minResetY}initial(){if(void 0===this._owner)throw new Error("owner is undefined.");this._owner.transform.position.copyFrom(this._initialPosition.toVector3())}}t.ScrollBehavior=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0),r=i(4);class o{setFromJson(e){if(void 0===e.messageCode)throw new Error("VisibilityOnMessageBehaviorData requires 'messageCode' to be defined.");if(this.messageCode=String(e.messageCode),void 0===e.visible)throw new Error("VisibilityOnMessageBehaviorData requires 'visible' to be defined.");this.visible=Boolean(e.visible)}}t.VisibilityOnMessageBehaviorData=o;t.VisibilityOnMessageBehaviorBuilder=class{get type(){return"visibilityOnMessage"}buildFromJson(e){let t=new o;return t.setFromJson(e),new n(t)}};class n extends r.BaseBehavior{constructor(e){if(super(e),void 0===e.messageCode)throw new Error("VisibilityOnMessageBehavior requires 'messageCode' to be defined.");if(void 0===e.visible)throw new Error("VisibilityOnMessageBehavior requires 'visible' to be defined.");this._messageCode=e.messageCode,this._visible=e.visible,s.Message.subscribe(this._messageCode,this)}onMessage(e){if(void 0===this._owner)throw new Error("owner is undefined.");e.code===this._messageCode&&(this._owner.isVisible=this._visible)}}t.VisibilityOnMessageBehavior=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(2),r=i(5),o=i(0),n=i(51);class a{constructor(){this.origin=s.Vector3.zero}setFromJson(e){void 0!==e.name&&(this.name=String(e.name)),void 0!==e.fontName&&(this.fontName=String(e.fontName)),void 0!==e.text&&(this.text=String(e.text)),void 0!==e.origin&&this.origin.setFromJson(e.origin)}}t.BitmapTextComponentData=a;t.BitmapTextComponentBuilder=class{get type(){return"bitmapText"}buildFromJson(e,t){let i=new a;return i.setFromJson(t),new h(e,i)}};class h extends r.BaseComponent{constructor(e,t){if(super(t),void 0===t.fontName)throw new Error('BitmapTextComponent requires "fontName".');this._fontName=t.fontName,this._bitmapText=new n.BitmapText(this.name,this._fontName,e),t.origin.equals(s.Vector3.zero)||this._bitmapText.origin.copyFrom(t.origin),this._bitmapText.text=t.text,o.Message.subscribe(this.name+":SetText",this)}load(){this._bitmapText.load()}update(e){this._bitmapText.update(e)}render(e){if(void 0===this.owner)throw new Error("owner is undefined.");this._bitmapText.draw(e,this.owner.worldMatrix),super.render(e)}onMessage(e){e.code===this.name+":SetText"&&(this._bitmapText.text=String(e.context))}}t.BitmapTextComponent=h},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(2),r=i(17),o=i(10),n=i(18),a=i(24),h=i(11);t.BitmapText=class{constructor(e,t,i){this._isDirty=!1,this._origin=s.Vector3.zero,this._vertices=[],this._text="",this._name=e,this._fontName=t,this._gl=i}get name(){return this._name}get text(){return this._text}set text(e){this._text!==e&&(this._text=e,this._isDirty=!0)}get origin(){return this._origin}set origin(e){this._origin=e,this.calculateVertices()}destroy(){this._buffer&&this._buffer.destroy(),this._material&&this._material.destroy(),this._material=void 0}load(){this._bitmapFont=a.BitmapFontManager.getFont(this._fontName),this._material=new o.Material(this._gl,`BITMAP_FONT_${this.name}_${this._bitmapFont.size}`,this._bitmapFont.textureName,h.Color.white()),this._buffer=new r.GLBuffer(this._gl);let e=new r.AttributeInfo(0,3);this._buffer.addAttributeLocation(e);let t=new r.AttributeInfo(1,2);this._buffer.addAttributeLocation(t)}update(e){this._isDirty&&this._bitmapFont.isLoaded&&(this.calculateVertices(),this._isDirty=!1)}draw(e,t){let i=e.getUniformLocation("u_model");this._gl.uniformMatrix4fv(i,!1,t.toFloat32Array());let s=e.getUniformLocation("u_tint");if(this._gl.uniform4fv(s,this._material.tint.toFloat32Array()),void 0!==this._material.diffuseTexture){this._material.diffuseTexture.activateAndBind(0);let t=e.getUniformLocation("u_diffuse");this._gl.uniform1i(t,0)}this._buffer.bind(),this._buffer.draw()}calculateVertices(){this._vertices.length=0,this._buffer.clearData();let e=0,t=0;for(let i of this._text){if("\n"===i){e=0,t+=this._bitmapFont.size;continue}let s=this._bitmapFont.getGlyph(i),r=e+s.xOffset,o=t+s.yOffset,a=r+s.width,h=o+s.height,d=s.x/this._bitmapFont.imageWidth,c=s.y/this._bitmapFont.imageHeight,l=(s.x+s.width)/this._bitmapFont.imageWidth,u=(s.y+s.height)/this._bitmapFont.imageHeight;this._vertices.push(new n.Vertex(r,o,0,d,c)),this._vertices.push(new n.Vertex(r,h,0,d,u)),this._vertices.push(new n.Vertex(a,h,0,l,u)),this._vertices.push(new n.Vertex(a,h,0,l,u)),this._vertices.push(new n.Vertex(a,o,0,l,c)),this._vertices.push(new n.Vertex(r,o,0,d,c)),e+=s.xAdvance}for(let e of this._vertices)this._buffer.pushBackData(e.toArray());this._buffer.upload(),this._buffer.unbind()}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(3),r=i(0),o=i(1);class n{static extractFieldValue(e){return e.split("=")[1]}}class a{static fromFields(e){let t=new a;return t.id=Number(n.extractFieldValue(e[1])),t.x=Number(n.extractFieldValue(e[2])),t.y=Number(n.extractFieldValue(e[3])),t.width=Number(n.extractFieldValue(e[4])),t.height=Number(n.extractFieldValue(e[5])),t.xOffset=Number(n.extractFieldValue(e[6])),t.yOffset=Number(n.extractFieldValue(e[7])),t.xAdvance=Number(n.extractFieldValue(e[8])),t.page=Number(n.extractFieldValue(e[9])),t.channel=Number(n.extractFieldValue(e[10])),t}}t.FontGlyph=a;t.BitmapFont=class{constructor(e,t){this._assetLoaded=!1,this._imageFile="",this._glyphs={},this._size=0,this._imageWidth=0,this._imageHeight=0,this._name=e,this._fontFileName=t}get name(){return this._name}get size(){return this._size}get imageWidth(){return this._imageWidth}get imageHeight(){return this._imageHeight}get textureName(){return this._imageFile}get isLoaded(){return this._assetLoaded}load(){let e=s.AssetManager.getAsset(this._fontFileName);void 0!==e?this.processFontFile(e.data):r.Message.subscribe(s.MESSAGE_ASSET_LOADER_ASSET_LOADED+this._fontFileName,this)}onMessage(e){e.code===s.MESSAGE_ASSET_LOADER_ASSET_LOADED+this._fontFileName&&this.processFontFile(e.context.data)}getGlyph(e){let t=e.charCodeAt(0);return t=void 0===this._glyphs[t]?63:t,this._glyphs[t]}measureText(e){let t=o.Vector2.zero,i=0,s=0,r=0;for(let t of e)switch(t){case"\n":s>i&&(i=s),s=0,r+=this._size;break;default:s+=this.getGlyph(t).xAdvance}return t.set(i,r),t}processFontFile(e){let t=0,i=e.split("\n");for(let e of i){let i=e.replace(/\s\s+/g," ").split(" ");switch(i[0]){case"info":this._size=Number(n.extractFieldValue(i[2]));break;case"common":this._imageWidth=Number(n.extractFieldValue(i[3])),this._imageHeight=Number(n.extractFieldValue(i[4]));break;case"page":this._imageFile=n.extractFieldValue(i[2]),this._imageFile=this._imageFile.replace(/"/g,""),this._imageFile=("resource/fonts/"+this._imageFile).trim();break;case"chars":t=Number(n.extractFieldValue(i[1])),t++;break;case"char":{let e=a.fromFields(i);this._glyphs[e.id]=e}}}let s=0,r=Object.keys(this._glyphs);for(let e of r)this._glyphs.hasOwnProperty(e)&&s++;if(s!==t)throw new Error(`Font file reported existence of ${t} glyphs, but only ${s} were found.`);this._assetLoaded=!0}}}]);